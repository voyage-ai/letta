---
title: "Shared Memory Part 2: Task Coordination with Shared Queues"
subtitle: Build a data analysis team with shared task coordination
slug: cookbooks/shared-memory-task-coordination
---

This tutorial demonstrates how to use shared read/write memory blocks for task coordination in a multi-agent worker system.

## What You'll Learn

- Creating read/write shared blocks that multiple agents can update
- Coordinating work across multiple worker agents
- Implementing supervisor-worker patterns
- Handling concurrent updates to shared state
- Combining shared task queues with private work logs

## Prerequisites

```bash
pip install letta-client
```

Set your Letta API key:
```bash
export LETTA_API_KEY="your-api-key-here"
```

## Part 1: Setup and Block Creation

```python
"""
Tutorial 2: Task Coordination with Shared Queues
================================================

Build a data analysis team with shared task queue and completion tracking.
"""

from letta import Letta
from datetime import datetime

# Initialize client
client = Letta()

print("=" * 70)
print("TUTORIAL 2: Task Coordination with Shared Queues")
print("=" * 70)
print()

# Create Shared Task Queue (Read/Write, All Team Members)
print("STEP 1: Creating shared task queue block (read/write)...\n")

task_queue = client.blocks.create(
    label="task_queue",
    description="Shared task queue for team coordination. All agents can read and update.",
    value="""
=== ACTIVE TASK QUEUE ===
Last Updated: 2024-10-08 09:00 AM

PENDING TASKS:
---------------
[TASK-001] Analyze Q4 Sales Data
  Priority: HIGH
  Status: Unassigned
  Est. Time: 2 hours
  Description: Analyze Q4 sales trends, identify top products, regional performance

[TASK-002] Generate Customer Churn Report
  Priority: MEDIUM
  Status: Unassigned
  Est. Time: 3 hours
  Description: Identify at-risk customers, calculate churn rate, recommend retention strategies

[TASK-003] Competitor Research Summary
  Priority: MEDIUM
  Status: Unassigned
  Est. Time: 1.5 hours
  Description: Research top 3 competitors, pricing analysis, feature comparison

[TASK-004] Website Traffic Analysis
  Priority: LOW
  Status: Unassigned
  Est. Time: 1 hour
  Description: Analyze website traffic patterns, conversion rates, bounce rates

IN PROGRESS:
---------------
(none)

BLOCKED:
---------------
(none)
""",
    limit=10000
)

print(f"✓ Created block: {task_queue.id}")
print(f"  Label: {task_queue.label}")
print(f"  Read/Write: True")
print(f"  Accessible by: Supervisor + All Workers")
print(f"  Initial tasks: 4 pending")
print()

# Create Shared Completed Work Log (Read/Write, All Team Members)
print("STEP 2: Creating shared completed work log (read/write)...\n")

completed_work = client.blocks.create(
    label="completed_work",
    description="Shared log of completed tasks with summaries and findings.",
    value="""
=== COMPLETED WORK LOG ===
Last Updated: 2024-10-08 09:00 AM

COMPLETED TASKS:
---------------
(no completed tasks yet)

TOTAL COMPLETED: 0
AVERAGE COMPLETION TIME: N/A
""",
    limit=12000
)

print(f"✓ Created block: {completed_work.id}")
print(f"  Label: {completed_work.label}")
print(f"  Read/Write: True")
print(f"  Purpose: Track completed work and share findings across team")
print()

# Create Team Metrics Block (Supervisor Only)
print("STEP 3: Creating supervisor-only team metrics block...\n")

team_metrics = client.blocks.create(
    label="team_metrics",
    description="Team performance metrics. Supervisor access only.",
    value="""
=== TEAM PERFORMANCE METRICS ===
Date: 2024-10-08

WORKER STATISTICS:
------------------
Data Analyst Worker 1: 0 tasks completed
Data Analyst Worker 2: 0 tasks completed
Research Worker 3: 0 tasks completed

TEAM TOTALS:
------------------
Total tasks assigned: 4
Total tasks completed: 0
Total tasks in progress: 0
Total tasks blocked: 0

PERFORMANCE:
------------------
Average completion time: N/A
Team velocity: N/A
Current utilization: 0%

NOTES:
------------------
Team just started, baseline metrics to be established.
""",
    limit=8000
)

print(f"✓ Created block: {team_metrics.id}")
print(f"  Label: {team_metrics.label}")
print(f"  Read/Write: True")
print(f"  Access: Supervisor only (private)")
print()
```

<Accordion title="Expected Output">
```
======================================================================
TUTORIAL 2: Task Coordination with Shared Queues
======================================================================

STEP 1: Creating shared task queue block (read/write)...

✓ Created block: block-f1e2d3c4-b5a6-9870-cdef-ab1234567890
  Label: task_queue
  Read/Write: True
  Accessible by: Supervisor + All Workers
  Initial tasks: 4 pending

STEP 2: Creating shared completed work log (read/write)...

✓ Created block: block-g2f3e4d5-c6b7-0981-defg-bc2345678901
  Label: completed_work
  Read/Write: True
  Purpose: Track completed work and share findings across team

STEP 3: Creating supervisor-only team metrics block...

✓ Created block: block-h3g4f5e6-d7c8-1092-efgh-cd3456789012
  Label: team_metrics
  Read/Write: True
  Access: Supervisor only (private)
```
</Accordion>

## Part 2: Agent Creation

Now let's create a project supervisor and three specialized workers.

```python
# Create Project Supervisor
print("STEP 4: Creating project supervisor...\n")

supervisor = client.agents.create(
    name="Project_Supervisor",
    model="openai/gpt-4o",
    embedding="openai/text-embedding-3-small",
    memory_blocks=[
        {
            "label": "persona",
            "value": """I am a Project Supervisor managing a data analytics team.

My role:
- Assign tasks to team members
- Monitor task progress and team performance
- Track team metrics and productivity
- Unblock workers and resolve issues
- Coordinate work distribution

My capabilities:
- Update task_queue (assign, modify priorities, reassign)
- Read completed_work (review team output)
- Update team_metrics (track performance - PRIVATE)
- Reassign blocked tasks
- Provide guidance to workers

My style:
- Clear and direct communication
- Encourage team collaboration
- Data-driven decision making
- Supportive leadership
"""
        },
        {
            "label": "human",
            "value": "Name: Team Manager\nRole: Managing the analytics team"
        }
    ],
    block_ids=[task_queue.id, completed_work.id, team_metrics.id],
    tools=["core_memory_append", "core_memory_replace"],
)

print(f"✓ Created Supervisor: {supervisor.id}")
print(f"  Name: {supervisor.name}")
print(f"  Shared blocks: task_queue, completed_work")
print(f"  Private blocks: team_metrics")
print()

# Create Worker 1 - Data Analyst
print("STEP 5: Creating Data Analyst Worker 1...\n")

worker1_log = client.blocks.create(
    label="worker1_work_log",
    description="Private work log for Data Analyst Worker 1.",
    value="""
=== WORKER 1 PRIVATE WORK LOG ===
Date: 2024-10-08

CURRENT TASK: None
TASKS COMPLETED TODAY: 0

PERSONAL NOTES:
---------------
Ready to start work. Specialization: Sales and financial data analysis.
""",
    limit=5000
)

worker1 = client.agents.create(
    name="Data_Analyst_Worker_1",
    model="openai/gpt-4o-mini",
    embedding="openai/text-embedding-3-small",
    memory_blocks=[
        {
            "label": "persona",
            "value": """I am Data Analyst Worker 1, specializing in sales and financial analysis.

My role:
- Claim tasks from the shared task queue
- Complete data analysis tasks
- Update task status in shared queue
- Log completed work with findings
- Maintain my private work log

My capabilities:
- Read task_queue (see available tasks)
- Update task_queue (claim tasks, update status)
- Update completed_work (share findings)
- Update my private work_log (personal notes)

My specialties:
- Sales data analysis
- Financial metrics and reporting
- Revenue trend analysis
- Performance dashboards

My style:
- Detail-oriented and thorough
- Data-driven insights
- Clear documentation
"""
        },
        {
            "label": "human",
            "value": "Name: Project Supervisor\nRole: Managing my work"
        }
    ],
    block_ids=[task_queue.id, completed_work.id, worker1_log.id],
    tools=["core_memory_append", "core_memory_replace"],
)

print(f"✓ Created Worker 1: {worker1.id}")
print(f"  Specialty: Sales and financial analysis")
print()

# Create Worker 2 - Data Analyst
print("STEP 6: Creating Data Analyst Worker 2...\n")

worker2_log = client.blocks.create(
    label="worker2_work_log",
    description="Private work log for Data Analyst Worker 2.",
    value="""
=== WORKER 2 PRIVATE WORK LOG ===
Date: 2024-10-08

CURRENT TASK: None
TASKS COMPLETED TODAY: 0

PERSONAL NOTES:
---------------
Ready to start work. Specialization: Customer behavior and web analytics.
""",
    limit=5000
)

worker2 = client.agents.create(
    name="Data_Analyst_Worker_2",
    model="openai/gpt-4o-mini",
    embedding="openai/text-embedding-3-small",
    memory_blocks=[
        {
            "label": "persona",
            "value": """I am Data Analyst Worker 2, specializing in customer behavior and web analytics.

My role:
- Claim tasks from the shared task queue
- Complete data analysis tasks
- Update task status in shared queue
- Log completed work with findings
- Maintain my private work log

My capabilities:
- Read task_queue (see available tasks)
- Update task_queue (claim tasks, update status)
- Update completed_work (share findings)
- Update my private work_log (personal notes)

My specialties:
- Customer churn analysis
- Web traffic and conversion analytics
- User behavior patterns
- Retention strategies

My style:
- Customer-focused insights
- Actionable recommendations
- Visual data presentation
"""
        },
        {
            "label": "human",
            "value": "Name: Project Supervisor\nRole: Managing my work"
        }
    ],
    block_ids=[task_queue.id, completed_work.id, worker2_log.id],
    tools=["core_memory_append", "core_memory_replace"],
)

print(f"✓ Created Worker 2: {worker2.id}")
print(f"  Specialty: Customer behavior and web analytics")
print()

# Create Worker 3 - Research Worker
print("STEP 7: Creating Research Worker 3...\n")

worker3_log = client.blocks.create(
    label="worker3_work_log",
    description="Private work log for Research Worker 3.",
    value="""
=== WORKER 3 PRIVATE WORK LOG ===
Date: 2024-10-08

CURRENT TASK: None
TASKS COMPLETED TODAY: 0

PERSONAL NOTES:
---------------
Ready to start work. Specialization: Market research and competitive analysis.
""",
    limit=5000
)

worker3 = client.agents.create(
    name="Research_Worker_3",
    model="anthropic/claude-3-5-sonnet-20241022",
    embedding="openai/text-embedding-3-small",
    memory_blocks=[
        {
            "label": "persona",
            "value": """I am Research Worker 3, specializing in market research and competitive analysis.

My role:
- Claim tasks from the shared task queue
- Complete research tasks
- Update task status in shared queue
- Log completed work with findings
- Maintain my private work log

My capabilities:
- Read task_queue (see available tasks)
- Update task_queue (claim tasks, update status)
- Update completed_work (share findings)
- Update my private work_log (personal notes)
- Conduct web research (when needed)

My specialties:
- Competitive analysis
- Market research
- Industry trends
- Strategic insights

My style:
- Comprehensive research
- Strategic thinking
- Well-sourced insights
"""
        },
        {
            "label": "human",
            "value": "Name: Project Supervisor\nRole: Managing my work"
        }
    ],
    block_ids=[task_queue.id, completed_work.id, worker3_log.id],
    tools=["core_memory_append", "core_memory_replace", "web_search"],
)

print(f"✓ Created Worker 3: {worker3.id}")
print(f"  Specialty: Market research and competitive analysis")
print()

print("=" * 70)
print("TEAM STRUCTURE CREATED")
print("=" * 70)
print("""
BLOCK ACCESS MATRIX:
                        task_queue  completed_work  team_metrics  work_log
Supervisor              R/W         R/W            R/W           -
Data Analyst Worker 1   R/W         R/W            -             R/W (own)
Data Analyst Worker 2   R/W         R/W            -             R/W (own)
Research Worker 3       R/W         R/W            -             R/W (own)

SHARED BLOCKS (All team members):
- task_queue: Coordinate work assignments and status
- completed_work: Share findings and deliverables

PRIVATE BLOCKS:
- team_metrics: Supervisor only (team performance tracking)
- work_log: Each worker has their own (personal notes)
""")
```

<Note>
Unlike Tutorial 1 where blocks were read-only, here the `task_queue` and `completed_work` blocks are **read/write** for all team members. This enables dynamic coordination where workers can claim tasks and share results.
</Note>

## Part 3: Message Flow Scenarios

### Scenario 1: Supervisor Adds New Task

```python
print("\n" + "=" * 70)
print("SCENARIO 1: Supervisor Adds Urgent Task")
print("=" * 70)
print("\nUser → Supervisor: 'Add a new HIGH priority task: Create executive dashboard for tomorrow's board meeting'\n")

response = client.agents.messages.create(
    agent_id=supervisor.id,
    messages=[{
        "role": "user",
        "content": "Add a new HIGH priority task to the queue: Create executive dashboard for tomorrow's board meeting. Estimated 2 hours. This is urgent."
    }]
)

for msg in response.messages:
    if msg.message_type == "assistant_message":
        print(f"Supervisor: {msg.content}\n")

# Check updated task queue
updated_queue = client.blocks.retrieve(block_id=task_queue.id)
print("Updated task_queue block (showing PENDING TASKS section):")
print("-" * 70)
pending_section = updated_queue.value.split("IN PROGRESS:")[0]
print(pending_section)
print("-" * 70)

print("\nAnalysis:")
print("- Supervisor updated shared task_queue block")
print("- Added TASK-005 with HIGH priority")
print("- All workers can now see this new task")
print("- Change is immediately visible to entire team")
```

<Accordion title="Expected Output">
```
======================================================================
SCENARIO 1: Supervisor Adds Urgent Task
======================================================================

User → Supervisor: 'Add a new HIGH priority task: Create executive dashboard for tomorrow's board meeting'

Supervisor: I've added a new HIGH priority task to the queue:

[TASK-005] Create Executive Dashboard
  Priority: HIGH
  Status: Unassigned
  Est. Time: 2 hours
  Description: Create executive dashboard for tomorrow's board meeting

This task is now visible to all team members and ready to be claimed. Given the urgency, I recommend assigning this to our most available worker.

Updated task_queue block (showing PENDING TASKS section):
----------------------------------------------------------------------
=== ACTIVE TASK QUEUE ===
Last Updated: 2024-10-08 09:15 AM

PENDING TASKS:
---------------
[TASK-001] Analyze Q4 Sales Data
  Priority: HIGH
  Status: Unassigned
  Est. Time: 2 hours
  Description: Analyze Q4 sales trends, identify top products, regional performance

[TASK-002] Generate Customer Churn Report
  Priority: MEDIUM
  Status: Unassigned
  Est. Time: 3 hours
  Description: Identify at-risk customers, calculate churn rate, recommend retention strategies

[TASK-003] Competitor Research Summary
  Priority: MEDIUM
  Status: Unassigned
  Est. Time: 1.5 hours
  Description: Research top 3 competitors, pricing analysis, feature comparison

[TASK-004] Website Traffic Analysis
  Priority: LOW
  Status: Unassigned
  Est. Time: 1 hour
  Description: Analyze website traffic patterns, conversion rates, bounce rates

[TASK-005] Create Executive Dashboard
  Priority: HIGH
  Status: Unassigned
  Est. Time: 2 hours
  Description: Create executive dashboard for tomorrow's board meeting

----------------------------------------------------------------------

Analysis:
- Supervisor updated shared task_queue block
- Added TASK-005 with HIGH priority
- All workers can now see this new task
- Change is immediately visible to entire team
```
</Accordion>

### Scenario 2: Worker 1 Claims Sales Analysis Task

```python
print("\n" + "=" * 70)
print("SCENARIO 2: Worker 1 Claims Task")
print("=" * 70)
print("\nUser → Worker 1: 'Check the task queue and claim the Q4 Sales Data analysis task (TASK-001)'\n")

response = client.agents.messages.create(
    agent_id=worker1.id,
    messages=[{
        "role": "user",
        "content": "Check the task queue and claim the Q4 Sales Data analysis task (TASK-001). Update the status to show you're working on it."
    }]
)

for msg in response.messages:
    if msg.message_type == "assistant_message":
        print(f"Worker 1: {msg.content}\n")

# Check updated task queue
updated_queue = client.blocks.retrieve(block_id=task_queue.id)
print("Updated task_queue block (showing IN PROGRESS section):")
print("-" * 70)
in_progress_section = updated_queue.value.split("IN PROGRESS:")[1].split("BLOCKED:")[0]
print("IN PROGRESS:")
print(in_progress_section)
print("-" * 70)

# Check Worker 1's private log
worker1_log_updated = client.blocks.retrieve(block_id=worker1_log.id)
print("\nWorker 1's private work_log:")
print("-" * 70)
print(worker1_log_updated.value[:400] + "...")
print("-" * 70)

print("\nAnalysis:")
print("- Worker 1 updated shared task_queue (moved TASK-001 to IN PROGRESS)")
print("- Worker 1 also updated their private work_log")
print("- Supervisor and other workers can see TASK-001 is now claimed")
print("- Worker's private notes are NOT visible to others")
```

<Accordion title="Expected Output">
```
======================================================================
SCENARIO 2: Worker 1 Claims Task
======================================================================

User → Worker 1: 'Check the task queue and claim the Q4 Sales Data analysis task (TASK-001)'

Worker 1: I've claimed TASK-001 (Analyze Q4 Sales Data) from the queue. This task aligns perfectly with my specialization in sales and financial analysis. I've updated the task status to "In Progress - Worker 1" and I'm starting work on it now.

I'll analyze Q4 sales trends, identify top-performing products, and evaluate regional performance. Estimated completion time is 2 hours.

Updated task_queue block (showing IN PROGRESS section):
----------------------------------------------------------------------
IN PROGRESS:
---------------
[TASK-001] Analyze Q4 Sales Data
  Priority: HIGH
  Status: In Progress - Data Analyst Worker 1
  Est. Time: 2 hours
  Started: 2024-10-08 09:20 AM
  Description: Analyze Q4 sales trends, identify top products, regional performance

----------------------------------------------------------------------

Worker 1's private work_log:
----------------------------------------------------------------------
=== WORKER 1 PRIVATE WORK LOG ===
Date: 2024-10-08

CURRENT TASK: TASK-001 - Analyze Q4 Sales Data
TASKS COMPLETED TODAY: 0

PERSONAL NOTES:
---------------
Started TASK-001 at 09:20 AM. This is a high-priority sales analysis task.
Plan: Pull Q4 data, segment by product and region, identify trends...
----------------------------------------------------------------------

Analysis:
- Worker 1 updated shared task_queue (moved TASK-001 to IN PROGRESS)
- Worker 1 also updated their private work_log
- Supervisor and other workers can see TASK-001 is now claimed
- Worker's private notes are NOT visible to others
```
</Accordion>

<Tip>
Notice how Worker 1 updates **both** the shared `task_queue` (visible to everyone) and their private `work_log` (visible only to them). This pattern allows for team coordination while maintaining personal notes.
</Tip>

### Scenario 3: Worker 2 Claims Different Task (Concurrent Access)

```python
print("\n" + "=" * 70)
print("SCENARIO 3: Worker 2 Claims Different Task (Concurrent Access)")
print("=" * 70)
print("\nUser → Worker 2: 'Claim the Customer Churn Report task (TASK-002)'\n")

response = client.agents.messages.create(
    agent_id=worker2.id,
    messages=[{
        "role": "user",
        "content": "Claim the Customer Churn Report task (TASK-002) from the queue. Update your status and start working on it."
    }]
)

for msg in response.messages:
    if msg.message_type == "assistant_message":
        print(f"Worker 2: {msg.content}\n")

# Check updated task queue
updated_queue = client.blocks.retrieve(block_id=task_queue.id)
print("Updated task_queue block (showing IN PROGRESS section):")
print("-" * 70)
in_progress_section = updated_queue.value.split("IN PROGRESS:")[1].split("BLOCKED:")[0]
print("IN PROGRESS:")
print(in_progress_section)
print("-" * 70)

print("\nAnalysis:")
print("- Worker 2 successfully claimed TASK-002")
print("- Both TASK-001 (Worker 1) and TASK-002 (Worker 2) now in progress")
print("- Shared block handled concurrent updates")
print("- No task conflicts (different workers, different tasks)")
```

<Accordion title="Expected Output">
```
======================================================================
SCENARIO 3: Worker 2 Claims Different Task (Concurrent Access)
======================================================================

User → Worker 2: 'Claim the Customer Churn Report task (TASK-002)'

Worker 2: Perfect! I've claimed TASK-002 (Generate Customer Churn Report). This aligns with my specialization in customer behavior analytics. I've updated the task queue to show I'm working on it.

I'll be identifying at-risk customers, calculating churn rates, and developing retention strategy recommendations. Estimated completion: 3 hours.

Updated task_queue block (showing IN PROGRESS section):
----------------------------------------------------------------------
IN PROGRESS:
---------------
[TASK-001] Analyze Q4 Sales Data
  Priority: HIGH
  Status: In Progress - Data Analyst Worker 1
  Est. Time: 2 hours
  Started: 2024-10-08 09:20 AM
  Description: Analyze Q4 sales trends, identify top products, regional performance

[TASK-002] Generate Customer Churn Report
  Priority: MEDIUM
  Status: In Progress - Data Analyst Worker 2
  Est. Time: 3 hours
  Started: 2024-10-08 09:25 AM
  Description: Identify at-risk customers, calculate churn rate, recommend retention strategies

----------------------------------------------------------------------

Analysis:
- Worker 2 successfully claimed TASK-002
- Both TASK-001 (Worker 1) and TASK-002 (Worker 2) now in progress
- Shared block handled concurrent updates
- No task conflicts (different workers, different tasks)
```
</Accordion>

<Warning>
In production systems with high concurrency, you may want to implement additional locking mechanisms or use optimistic concurrency control to prevent race conditions when multiple agents try to claim the same task simultaneously.
</Warning>

### Scenario 4: Supervisor Checks Progress

```python
print("\n" + "=" * 70)
print("SCENARIO 4: Supervisor Checks Team Progress")
print("=" * 70)
print("\nUser → Supervisor: 'What tasks are currently in progress? Who's working on what?'\n")

response = client.agents.messages.create(
    agent_id=supervisor.id,
    messages=[{
        "role": "user",
        "content": "Give me a status update. What tasks are currently in progress and who is working on them?"
    }]
)

for msg in response.messages:
    if msg.message_type == "assistant_message":
        print(f"Supervisor: {msg.content}\n")

print("Analysis:")
print("- Supervisor read the shared task_queue block")
print("- Saw real-time updates from both workers")
print("- Supervisor did NOT see workers' private work logs")
print("- Demonstrates shared block visibility for coordination")
```

<Accordion title="Expected Output">
```
======================================================================
SCENARIO 4: Supervisor Checks Team Progress
======================================================================

User → Supervisor: 'What tasks are currently in progress? Who's working on what?'

Supervisor: Here's the current team status:

**In Progress (2 tasks):**
1. TASK-001: Analyze Q4 Sales Data
   - Assigned to: Data Analyst Worker 1
   - Priority: HIGH
   - Started: 09:20 AM
   - Est. completion: ~11:20 AM (2 hours)

2. TASK-002: Generate Customer Churn Report
   - Assigned to: Data Analyst Worker 2
   - Priority: MEDIUM
   - Started: 09:25 AM
   - Est. completion: ~12:25 PM (3 hours)

**Available Workers:**
- Research Worker 3 (available for assignment)

**Pending High-Priority Tasks:**
- TASK-005: Create Executive Dashboard (URGENT - for tomorrow's board meeting)

I recommend assigning TASK-005 to Research Worker 3 or waiting for Worker 1 to complete their current task.

Analysis:
- Supervisor read the shared task_queue block
- Saw real-time updates from both workers
- Supervisor did NOT see workers' private work logs
- Demonstrates shared block visibility for coordination
```
</Accordion>

### Scenario 5: Worker 1 Completes Task and Shares Findings

```python
print("\n" + "=" * 70)
print("SCENARIO 5: Worker 1 Completes Task and Shares Findings")
print("=" * 70)
print("\nUser → Worker 1: 'You've finished analyzing the Q4 sales data. Key findings: Sales up 23% YoY, top product is Premium Plan ($2.3M), West region leads. Mark complete and log findings.'\n")

response = client.agents.messages.create(
    agent_id=worker1.id,
    messages=[{
        "role": "user",
        "content": """You've finished the Q4 sales analysis. Here are your findings:

Key Findings:
- Total Q4 sales: $8.7M (up 23% YoY)
- Top performing product: Premium Plan ($2.3M revenue)
- Best performing region: West Coast (35% of total sales)
- Growth driver: 45% increase in Premium Plan subscriptions
- Recommendation: Invest more in Premium Plan marketing for West Coast region

Mark TASK-001 as complete in the task queue and add these findings to the completed work log so the team can see them."""
    }]
)

for msg in response.messages:
    if msg.message_type == "assistant_message":
        print(f"Worker 1: {msg.content}\n")

# Check completed work log
completed_work_updated = client.blocks.retrieve(block_id=completed_work.id)
print("Updated completed_work block:")
print("-" * 70)
print(completed_work_updated.value)
print("-" * 70)

# Check task queue
updated_queue = client.blocks.retrieve(block_id=task_queue.id)
print("\nTask queue - IN PROGRESS section:")
print("-" * 70)
in_progress_section = updated_queue.value.split("IN PROGRESS:")[1].split("BLOCKED:")[0]
print("IN PROGRESS:")
print(in_progress_section)
print("-" * 70)

print("\nAnalysis:")
print("- Worker 1 updated task_queue (removed TASK-001 from IN PROGRESS)")
print("- Worker 1 updated completed_work (added findings)")
print("- Findings are now visible to entire team")
print("- Supervisor can review completed work")
print("- Other workers can learn from these findings")
```

<Accordion title="Expected Output">
```
======================================================================
SCENARIO 5: Worker 1 Completes Task and Shares Findings
======================================================================

User → Worker 1: 'You've finished analyzing the Q4 sales data...'

Worker 1: Excellent! I've completed TASK-001 and documented the findings. Let me update both the task queue and completed work log.

Updated completed_work block:
----------------------------------------------------------------------
=== COMPLETED WORK LOG ===
Last Updated: 2024-10-08 11:20 AM

COMPLETED TASKS:
---------------
[TASK-001] Analyze Q4 Sales Data
  Completed by: Data Analyst Worker 1
  Completion time: 2 hours
  Completed at: 2024-10-08 11:20 AM

KEY FINDINGS:
- Total Q4 sales: $8.7M (up 23% YoY) ✓
- Top performing product: Premium Plan ($2.3M revenue)
- Best performing region: West Coast (35% of total sales)
- Growth driver: 45% increase in Premium Plan subscriptions
- **Recommendation:** Invest more in Premium Plan marketing for West Coast region

TOTAL COMPLETED: 1
AVERAGE COMPLETION TIME: 2 hours
----------------------------------------------------------------------

Task queue - IN PROGRESS section:
----------------------------------------------------------------------
IN PROGRESS:
---------------
[TASK-002] Generate Customer Churn Report
  Priority: MEDIUM
  Status: In Progress - Data Analyst Worker 2
  Est. Time: 3 hours
  Started: 2024-10-08 09:25 AM
  Description: Identify at-risk customers, calculate churn rate, recommend retention strategies

----------------------------------------------------------------------

Analysis:
- Worker 1 updated task_queue (removed TASK-001 from IN PROGRESS)
- Worker 1 updated completed_work (added findings)
- Findings are now visible to entire team
- Supervisor can review completed work
- Other workers can learn from these findings
```
</Accordion>

<Note>
This demonstrates the power of shared `completed_work` blocks: knowledge is immediately available to the entire team, enabling better decision-making and collaboration.
</Note>

### Scenario 6: Worker 3 Views Completed Work Before Starting

```python
print("\n" + "=" * 70)
print("SCENARIO 6: Worker 3 Checks Completed Work Before Starting")
print("=" * 70)
print("\nUser → Worker 3: 'Before claiming a task, check what work has been completed so far by the team.'\n")

response = client.agents.messages.create(
    agent_id=worker3.id,
    messages=[{
        "role": "user",
        "content": "Before you claim a task, check the completed work log to see what the team has finished so far. Summarize any relevant findings."
    }]
)

for msg in response.messages:
    if msg.message_type == "assistant_message":
        print(f"Worker 3: {msg.content}\n")

print("Analysis:")
print("- Worker 3 read the shared completed_work block")
print("- Saw Worker 1's Q4 sales analysis findings")
print("- Can leverage this information for their own work")
print("- Demonstrates knowledge sharing through shared blocks")
```

<Accordion title="Expected Output">
```
======================================================================
SCENARIO 6: Worker 3 Checks Completed Work Before Starting
======================================================================

User → Worker 3: 'Before claiming a task, check what work has been completed so far by the team.'

Worker 3: Let me review the completed work log to understand what the team has accomplished.

I can see that Worker 1 has completed the Q4 Sales Data Analysis with some impressive findings:
- Q4 sales reached $8.7M, showing strong 23% year-over-year growth
- The Premium Plan is clearly the star performer at $2.3M in revenue
- West Coast region is dominating with 35% of total sales
- The growth is primarily driven by a 45% surge in Premium Plan subscriptions

This is valuable context! If I take on the Competitor Research task (TASK-003), I should definitely look at how competitors are positioning their premium offerings, especially in the West Coast market. These insights will help me provide more strategic competitive analysis.

Analysis:
- Worker 3 read the shared completed_work block
- Saw Worker 1's Q4 sales analysis findings
- Can leverage this information for their own work
- Demonstrates knowledge sharing through shared blocks
```
</Accordion>

### Scenario 7: Worker 3 Claims and Works on Research Task

```python
print("\n" + "=" * 70)
print("SCENARIO 7: Worker 3 Claims Research Task")
print("=" * 70)
print("\nUser → Worker 3: 'Claim the Competitor Research Summary task (TASK-003) and start working on it.'\n")

response = client.agents.messages.create(
    agent_id=worker3.id,
    messages=[{
        "role": "user",
        "content": "Claim TASK-003 (Competitor Research Summary) from the queue. Update the status and begin your research."
    }]
)

for msg in response.messages:
    if msg.message_type == "assistant_message":
        print(f"Worker 3: {msg.content}\n")

print("Analysis:")
print("- Worker 3 successfully claimed TASK-003")
print("- Now 2 tasks in progress (Worker 2: TASK-002, Worker 3: TASK-003)")
print("- Worker 1 has completed their task and is available")
```

<Accordion title="Expected Output">
```
======================================================================
SCENARIO 7: Worker 3 Claims Research Task
======================================================================

User → Worker 3: 'Claim the Competitor Research Summary task (TASK-003) and start working on it.'

Worker 3: Perfect! I've claimed TASK-003 (Competitor Research Summary). I'll leverage the insights from Worker 1's sales analysis to focus my research on how competitors are positioning their premium offerings, especially in high-performing regions.

I've updated the task queue to reflect I'm working on this. Estimated completion: 1.5 hours.

Analysis:
- Worker 3 successfully claimed TASK-003
- Now 2 tasks in progress (Worker 2: TASK-002, Worker 3: TASK-003)
- Worker 1 has completed their task and is available
```
</Accordion>

### Scenario 8: Supervisor Updates Private Team Metrics

```python
print("\n" + "=" * 70)
print("SCENARIO 8: Supervisor Updates Private Team Metrics")
print("=" * 70)
print("\nUser → Supervisor: 'Update the team metrics. Worker 1 completed 1 task in 2 hours. Current utilization: Worker 1 available, Workers 2 and 3 busy.'\n")

response = client.agents.messages.create(
    agent_id=supervisor.id,
    messages=[{
        "role": "user",
        "content": """Update the team metrics with the following:
- Worker 1: Completed 1 task (Q4 Sales Analysis) in 2 hours
- Worker 2: Currently working on Customer Churn Report (in progress)
- Worker 3: Currently working on Competitor Research (in progress)
- Team utilization: 67% (2 of 3 workers actively working)
- Total completed: 1 task
- Average completion time: 2 hours"""
    }]
)

for msg in response.messages:
    if msg.message_type == "assistant_message":
        print(f"Supervisor: {msg.content}\n")

# Check team metrics
team_metrics_updated = client.blocks.retrieve(block_id=team_metrics.id)
print("Updated team_metrics block (SUPERVISOR ONLY):")
print("-" * 70)
print(team_metrics_updated.value)
print("-" * 70)

print("\nAnalysis:")
print("- Supervisor updated private team_metrics block")
print("- Workers CANNOT see this block")
print("- Supervisor tracks performance without workers seeing metrics")
print("- Demonstrates mixed public (task_queue) + private (team_metrics) blocks")
```

<Accordion title="Expected Output">
```
======================================================================
SCENARIO 8: Supervisor Updates Private Team Metrics
======================================================================

User → Supervisor: 'Update the team metrics...'

Supervisor: I've updated the team performance metrics. Worker 1 is showing excellent productivity with a 2-hour completion time on a high-priority task. Team utilization is healthy at 67% with two active workers. Worker 1 is now available for the urgent executive dashboard task (TASK-005).

Updated team_metrics block (SUPERVISOR ONLY):
----------------------------------------------------------------------
=== TEAM PERFORMANCE METRICS ===
Date: 2024-10-08
Last Updated: 11:20 AM

WORKER STATISTICS:
------------------
Data Analyst Worker 1: 1 task completed (Q4 Sales Analysis - 2 hours)
Data Analyst Worker 2: 0 tasks completed (Working on TASK-002)
Research Worker 3: 0 tasks completed (Working on TASK-003)

TEAM TOTALS:
------------------
Total tasks assigned: 5
Total tasks completed: 1
Total tasks in progress: 2
Total tasks blocked: 0

PERFORMANCE:
------------------
Average completion time: 2 hours
Team velocity: 0.5 tasks/hour (based on Worker 1)
Current utilization: 67% (2/3 workers active)

NOTES:
------------------
Strong start. Worker 1 available for TASK-005 (urgent executive dashboard).
Worker 2 and Worker 3 on track.
----------------------------------------------------------------------

Analysis:
- Supervisor updated private team_metrics block
- Workers CANNOT see this block
- Supervisor tracks performance without workers seeing metrics
- Demonstrates mixed public (task_queue) + private (team_metrics) blocks
```
</Accordion>

### Scenario 9: Worker 2 Completes Churn Analysis

```python
print("\n" + "=" * 70)
print("SCENARIO 9: Worker 2 Completes Churn Analysis")
print("=" * 70)
print("\nUser → Worker 2: 'You finished the churn analysis. Findings: 12% monthly churn, at-risk segment is trial users who don't engage in first 7 days. Recommend onboarding email campaign. Complete the task.'\n")

response = client.agents.messages.create(
    agent_id=worker2.id,
    messages=[{
        "role": "user",
        "content": """You've completed the Customer Churn Report (TASK-002). Here are your findings:

Key Findings:
- Monthly churn rate: 12% (industry average: 15%)
- At-risk segment: Trial users with <2 logins in first 7 days
- Primary churn reasons: 1) Poor onboarding, 2) Feature confusion
- High-value customers churn rate: Only 3% (very good)
- Recommendation: Implement onboarding email campaign with product tutorials

Mark the task complete and share these findings with the team."""
    }]
)

for msg in response.messages:
    if msg.message_type == "assistant_message":
        print(f"Worker 2: {msg.content}\n")

# Check completed work
completed_work_updated = client.blocks.retrieve(block_id=completed_work.id)
print("Updated completed_work block (showing both completed tasks):")
print("-" * 70)
print(completed_work_updated.value[:1000] + "...")
print("-" * 70)

print("\nAnalysis:")
print("- Worker 2 completed TASK-002")
print("- Findings added to shared completed_work block")
print("- Now 2 tasks completed, visible to entire team")
print("- Only Worker 3's task remains in progress")
```

<Accordion title="Expected Output">
```
======================================================================
SCENARIO 9: Worker 2 Completes Churn Analysis
======================================================================

User → Worker 2: 'You finished the churn analysis...'

Worker 2: Excellent! I've completed TASK-002 and the findings are quite actionable. Our churn rate is actually better than industry average, but we have a clear opportunity to improve trial user retention. I've updated both the task queue and completed work log with the full analysis.

Updated completed_work block (showing both completed tasks):
----------------------------------------------------------------------
=== COMPLETED WORK LOG ===
Last Updated: 2024-10-08 12:25 PM

COMPLETED TASKS:
---------------
[TASK-001] Analyze Q4 Sales Data
  Completed by: Data Analyst Worker 1
  Completion time: 2 hours
  Completed at: 2024-10-08 11:20 AM

KEY FINDINGS:
- Total Q4 sales: $8.7M (up 23% YoY)
- Top performing product: Premium Plan ($2.3M revenue)
- Best performing region: West Coast (35% of total sales)
- Growth driver: 45% increase in Premium Plan subscriptions
- **Recommendation:** Invest more in Premium Plan marketing for West Coast

[TASK-002] Generate Customer Churn Report
  Completed by: Data Analyst Worker 2
  Completion time: 3 hours
  Completed at: 2024-10-08 12:25 PM

KEY FINDINGS:
- Monthly churn rate: 12% (below industry average of 15%) ✓
- At-risk segment: Trial users with <2 logins in first 7 days
- Primary churn reasons: Poor onboarding (45%), Feature confusion (30%)
- High-value customer churn: Only 3% (excellent retention)
- **Recommendation:** Implement automated onboarding email campaign with product...
----------------------------------------------------------------------

Analysis:
- Worker 2 completed TASK-002
- Findings added to shared completed_work block
- Now 2 tasks completed, visible to entire team
- Only Worker 3's task remains in progress
```
</Accordion>

### Scenario 10: Cross-Worker Knowledge Sharing

```python
print("\n" + "=" * 70)
print("SCENARIO 10: Worker 1 Learns from Worker 2's Completed Work")
print("=" * 70)
print("\nUser → Worker 1: 'Check the completed work log and tell me if Worker 2's churn findings relate to your sales analysis.'\n")

response = client.agents.messages.create(
    agent_id=worker1.id,
    messages=[{
        "role": "user",
        "content": "Review the completed work log. Do you see any connections between Worker 2's churn analysis and your Q4 sales findings? What insights emerge when you combine both analyses?"
    }]
)

for msg in response.messages:
    if msg.message_type == "assistant_message":
        print(f"Worker 1: {msg.content}\n")

print("Analysis:")
print("- Worker 1 read Worker 2's completed work")
print("- Both workers' findings are in shared completed_work block")
print("- Workers can synthesize insights across analyses")
print("- Demonstrates cross-functional collaboration through shared memory")
```

<Accordion title="Expected Output">
```
======================================================================
SCENARIO 10: Worker 1 Learns from Worker 2's Completed Work
======================================================================

User → Worker 1: 'Check the completed work log and tell me if Worker 2's churn findings relate to your sales analysis.'

Worker 1: Absolutely! Looking at both analyses together reveals important insights:

**The Connection:**
My analysis showed 45% growth in Premium Plan subscriptions, but Worker 2's churn analysis reveals that trial users (who haven't converted yet) are our biggest churn risk.

**Combined Insight:**
We're excellent at:
- Converting and retaining Premium customers (only 3% churn - Worker 2's finding)
- Growing Premium Plan revenue ($2.3M - my finding)

We need to improve:
- Trial-to-Premium conversion through better onboarding
- First-week engagement for trial users

**Recommendation:**
Focus onboarding campaigns specifically on Premium Plan features, especially in the West Coast region where we're seeing the most growth. This could convert more trial users into the Premium Plan customers who already show excellent retention.

This is a great example of how shared findings lead to more strategic insights!

Analysis:
- Worker 1 read Worker 2's completed work
- Both workers' findings are in shared completed_work block
- Workers can synthesize insights across analyses
- Demonstrates cross-functional collaboration through shared memory
```
</Accordion>

<Tip>
This scenario showcases one of the most powerful benefits of shared memory: **emergent insights** that arise when team members can access and synthesize each other's work.
</Tip>

## Part 4: Block Inspection and Summary

```python
# Check which agents use task_queue
print("\n" + "=" * 70)
print("INSPECTION: Block Usage Analysis")
print("=" * 70)

print("\n1. Checking task_queue block usage...")
queue_info = client.blocks.retrieve(block_id=task_queue.id)
print(f"\nBlock: {queue_info.label}")
print(f"Used by {len(queue_info.agent_ids)} agents:")
for agent_id in queue_info.agent_ids:
    agent_info = client.agents.retrieve(agent_id=agent_id)
    print(f"  - {agent_info.name} ({agent_id})")

print("\n2. Checking completed_work block usage...")
completed_info = client.blocks.retrieve(block_id=completed_work.id)
print(f"\nBlock: {completed_info.label}")
print(f"Used by {len(completed_info.agent_ids)} agents:")
for agent_id in completed_info.agent_ids:
    agent_info = client.agents.retrieve(agent_id=agent_id)
    print(f"  - {agent_info.name} ({agent_id})")

print("\n3. Checking team_metrics block usage...")
metrics_info = client.blocks.retrieve(block_id=team_metrics.id)
print(f"\nBlock: {metrics_info.label}")
print(f"Used by {len(metrics_info.agent_ids)} agent(s):")
for agent_id in metrics_info.agent_ids:
    agent_info = client.agents.retrieve(agent_id=agent_id)
    print(f"  - {agent_info.name} ({agent_id})")

print("\n" + "=" * 70)
print("TUTORIAL 2 COMPLETE: Key Takeaways")
print("=" * 70)

print("""
✓ Created 2 shared read/write blocks (task_queue, completed_work)
✓ Created 1 private supervisor block (team_metrics)
✓ Created 3 private worker blocks (individual work_logs)
✓ Demonstrated concurrent task claiming by multiple workers
✓ Showed real-time task coordination through shared blocks
✓ Demonstrated knowledge sharing through completed_work block
✓ Showed cross-worker collaboration and insight synthesis

BLOCK ACCESS MATRIX:
                        task_queue  completed_work  team_metrics  work_log
Supervisor              R/W         R/W            R/W           -
Worker 1                R/W         R/W            -             R/W (own)
Worker 2                R/W         R/W            -             R/W (own)
Worker 3                R/W         R/W            -             R/W (own)

PATTERNS DEMONSTRATED:
1. Read/write shared blocks enable dynamic team coordination
2. Workers can claim and update tasks in real-time
3. Completed work becomes immediately available to entire team
4. Private work logs allow personal notes without sharing
5. Supervisor maintains private metrics for performance tracking
6. Cross-worker knowledge sharing enables better insights

WORKFLOW PATTERN:
1. Supervisor adds tasks to shared queue
2. Workers claim tasks (update shared queue)
3. Workers complete tasks (update shared completed_work)
4. Other workers read completed work (inform their own work)
5. Supervisor tracks metrics privately (team_metrics)

NEXT STEPS:
- Tutorial 3: Multi-agent user assistant with overlapping block access
- Tutorial 4: Enterprise multi-team system with hierarchical blocks
""")
```

<Accordion title="Expected Output">
```
======================================================================
INSPECTION: Block Usage Analysis
======================================================================

1. Checking task_queue block usage...

Block: task_queue
Used by 4 agents:
  - Project_Supervisor (agent-56789012-ef01-2345-6789-01abcdef2345)
  - Data_Analyst_Worker_1 (agent-67890123-f012-3456-7890-12bcdef34567)
  - Data_Analyst_Worker_2 (agent-78901234-0123-4567-8901-23cdef456789)
  - Research_Worker_3 (agent-89012345-1234-5678-9012-34def5678901)

2. Checking completed_work block usage...

Block: completed_work
Used by 4 agents:
  - Project_Supervisor (agent-56789012-ef01-2345-6789-01abcdef2345)
  - Data_Analyst_Worker_1 (agent-67890123-f012-3456-7890-12bcdef34567)
  - Data_Analyst_Worker_2 (agent-78901234-0123-4567-8901-23cdef456789)
  - Research_Worker_3 (agent-89012345-1234-5678-9012-34def5678901)

3. Checking team_metrics block usage...

Block: team_metrics
Used by 1 agent(s):
  - Project_Supervisor (agent-56789012-ef01-2345-6789-01abcdef2345)

======================================================================
TUTORIAL 2 COMPLETE: Key Takeaways
======================================================================

✓ Created 2 shared read/write blocks (task_queue, completed_work)
✓ Created 1 private supervisor block (team_metrics)
✓ Created 3 private worker blocks (individual work_logs)
✓ Demonstrated concurrent task claiming by multiple workers
✓ Showed real-time task coordination through shared blocks
✓ Demonstrated knowledge sharing through completed_work block
✓ Showed cross-worker collaboration and insight synthesis

... (output continues)
```
</Accordion>

## Key Takeaways

<CardGroup cols={2}>
<Card title="Read/Write Shared Blocks" icon="pen-to-square">
Enable dynamic coordination where agents can both read and update shared state
</Card>

<Card title="Concurrent Updates" icon="arrows-spin">
Multiple agents can work simultaneously without conflicts when claiming different tasks
</Card>

<Card title="Knowledge Sharing" icon="share-nodes">
Completed work becomes immediately available to entire team for better insights
</Card>

<Card title="Mixed Block Types" icon="layer-group">
Combine shared blocks (team coordination) with private blocks (personal notes)
</Card>
</CardGroup>

### Patterns Demonstrated

1. **Read/write shared blocks** enable dynamic team coordination
2. **Task queue pattern** for work distribution across workers
3. **Completed work log** for knowledge sharing
4. **Private supervisor metrics** for performance tracking
5. **Cross-worker synthesis** of insights from multiple analyses

### Comparison with Tutorial 1

| Aspect | Tutorial 1 (Read-Only) | Tutorial 2 (Read/Write) |
|---|---|---|
| **Block Type** | Read-only shared blocks | Read/write shared blocks |
| **Use Case** | Organizational policies | Task coordination |
| **Updates** | No agent updates allowed | Agents actively update blocks |
| **Pattern** | Information cascade | Dynamic collaboration |
| **Coordination** | Passive (reference only) | Active (real-time updates) |

## Next Steps

<Card title="Part 3: Multi-Agent User Assistant" icon="users" href="/cookbooks/shared-memory-user-assistant">
Learn how to build a personal AI assistant network with overlapping block access patterns
</Card>
